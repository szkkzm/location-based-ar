<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Location-based AR.js demo</title>
    <!-- A-Frameの読み込み -->
    <script src="https://aframe.io/releases/1.0.4/aframe.min.js"></script>
    <!-- AR.jsの読み込み -->
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
  </head>

  <body style="margin: 0; overflow: hidden;">
    <!-- 現在地を表示する<p>タグ -->
    <p id="location" style="position: absolute; top: 10px; left: 10px; color: white; z-index: 1;">
      現在地を取得中...
    </p>

    <a-scene
    embedded
    arjs="sourceType: webcam;"
  >
  <a-box
  material="color: red"
  position="0 0 -5"
  gps-entity-place="latitude: 33.973840; longitude: 134.359977;"
  scale="1 1 1"
></a-box>
    <a-marker-camera preset="hiro"></a-marker-camera>
  </a-scene>

    <!-- 現在地をリアルタイムで取得して<p>タグに表示するスクリプト -->
    <script>
      // ブラウザがGeolocation APIをサポートしているか確認
      if ('geolocation' in navigator) {
        // watchPositionを使用して位置情報をリアルタイムで取得
        const watchId = navigator.geolocation.watchPosition(
          function (position) {
            // 緯度と経度を取得
            const latitude = (position.coords.latitude - 33.973840) *10000;
            const longitude = (position.coords.longitude - 134.359977)*10000;

            // HTMLの<p>タグに反映
            const locationElement = document.getElementById('location');
            locationElement.textContent = `現在地の緯度: ${latitude}, 経度: ${longitude}`;
          },
          function (error) {
            // エラー処理
            const locationElement = document.getElementById('location');
            switch (error.code) {
              case error.PERMISSION_DENIED:
                locationElement.textContent = '位置情報の取得がユーザーによって拒否されました。';
                break;
              case error.POSITION_UNAVAILABLE:
                locationElement.textContent = '位置情報が利用できません。';
                break;
              case error.TIMEOUT:
                locationElement.textContent = '位置情報の取得がタイムアウトしました。';
                break;
              default:
                locationElement.textContent = '未知のエラーが発生しました。';
                break;
            }
          },
          {
            enableHighAccuracy: true,
            timeout: 5000,
            maximumAge: 0,
          }
        );

        // 必要に応じて位置情報の監視を停止する場合
        // navigator.geolocation.clearWatch(watchId);
      } else {
        alert('お使いのブラウザはGeolocation APIをサポートしていません。');
      }
    </script>
  </body>
</html>
